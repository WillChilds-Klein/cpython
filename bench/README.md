# Benchmarking Python Cryptography

These benchmarks measure performance differences in CPython when built against
various crypto/TLS libraries, namely AWS-LC and a few versions of OpenSSL.
Specifically, we look at two relevant python modules: `ssl` and `hashlib`. For
each algorith or protocol, we measure 1000 samples and report the average
latency.

Benchmarks were performed on a 4-core ubuntu 22.04 x86_64 EC2 instance. The
results show that python's `hashlib` performance is comparable between all
libraries tested, but TLS handshakes are >2x faster when built against AWS-LC.
TLS connections used P256 ECDSA certificates. A current run of
`run_benchmarks.sh` yields the following in ~16m.


```
$ uname -a
Linux ip-172-31-89-138 6.2.0-1014-aws #14~22.04.1-Ubuntu SMP Thu Oct  5 22:43:45 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux

$ time ./bench/run_benchmarks.sh
OPENSSL VERSION: AWS-LC 1.19.0
   ALGO     SIZE (B)        TIME (s)      
   ====     ========        ========      
TLS        0          0.0007588777542114258
TLS        1024       0.0007767167091369629
TLS        1048576    0.0026535139083862305
md5        8          2.0067691802978515e-06
md5        1024       3.8847923278808595e-06
md5        1048576    0.0019870223999023436
sha1       8          1.948356628417969e-06
sha1       1024       3.4143924713134765e-06
sha1       1048576    0.0014357268810272217
sha256     8          2.0904541015625e-06 
sha256     1024       5.5680274963378904e-06
sha256     1048576    0.003498321056365967
sha384     8          2.3961067199707033e-06
sha384     1024       4.975557327270508e-06
sha384     1048576    0.0024674572944641112
sha512     8          2.3632049560546877e-06
sha512     1024       4.996299743652344e-06
sha512     1048576    0.0024674835205078125
sha3_256   8          2.328634262084961e-06
sha3_256   1024       6.1922073364257816e-06
sha3_256   1048576    0.004102666854858398
sha3_384   8          2.328157424926758e-06
sha3_384   1024       7.211923599243164e-06
sha3_384   1048576    0.005311457633972168
sha3_512   8          2.3417472839355467e-06
sha3_512   1024       9.813785552978515e-06
sha3_512   1048576    0.007621795892715454

OPENSSL VERSION: OpenSSL 1.1.1x-dev  xx XXX xxxx
   ALGO     SIZE (B)        TIME (s)      
   ====     ========        ========      
TLS        0          0.0017635645866394044
TLS        1024       0.0017914080619812012
TLS        1048576    0.0033635964393615722
md5        8          2.1982192993164064e-06
md5        1024       4.0740966796875e-06 
md5        1048576    0.0019938297271728514
sha1       8          2.089977264404297e-06
sha1       1024       3.5479068756103516e-06
sha1       1048576    0.001433232545852661
sha256     8          2.2377967834472654e-06
sha256     1024       5.328655242919922e-06
sha256     1048576    0.003086885929107666
sha384     8          2.4628639221191406e-06
sha384     1024       4.5962333679199216e-06
sha384     1048576    0.002089273929595947
sha512     8          2.5599002838134766e-06
sha512     1024       4.714012145996093e-06
sha512     1048576    0.0020906617641448973
sha3_256   8          2.5472640991210936e-06
sha3_256   1024       6.0372352600097654e-06
sha3_256   1048576    0.00377320671081543 
sha3_384   8          2.5267601013183596e-06
sha3_384   1024       6.997346878051758e-06
sha3_384   1048576    0.0048926806449890135
sha3_512   8          2.5496482849121096e-06
sha3_512   1024       9.338855743408204e-06
sha3_512   1048576    0.007006710529327393

OPENSSL VERSION: OpenSSL 3.0.13-dev 
   ALGO     SIZE (B)        TIME (s)      
   ====     ========        ========      
TLS        0          0.0024846296310424803
TLS        1024       0.002509083986282349
TLS        1048576    0.0035446507930755617
md5        8          2.2962093353271485e-06
md5        1024       4.253387451171875e-06
md5        1048576    0.0019970741271972655
sha1       8          2.2504329681396485e-06
sha1       1024       3.696441650390625e-06
sha1       1048576    0.001435577392578125
sha256     8          2.3541450500488283e-06
sha256     1024       5.472898483276367e-06
sha256     1048576    0.0030902726650238036
sha384     8          2.5074481964111327e-06
sha384     1024       4.750490188598633e-06
sha384     1048576    0.0020998992919921875
sha512     8          2.627849578857422e-06
sha512     1024       4.842519760131836e-06
sha512     1048576    0.002098009824752808
sha3_256   8          2.796173095703125e-06
sha3_256   1024       6.27446174621582e-06
sha3_256   1048576    0.0037845182418823242
sha3_384   8          2.7568340301513673e-06
sha3_384   1024       7.247209548950195e-06
sha3_384   1048576    0.004902421236038208
sha3_512   8          2.732515335083008e-06
sha3_512   1024       9.605646133422852e-06
sha3_512   1048576    0.0070149853229522705

OPENSSL VERSION: OpenSSL 3.2.1-dev 
   ALGO     SIZE (B)        TIME (s)      
   ====     ========        ========      
TLS        0          0.0022133321762084963
TLS        1024       0.0022422220706939697
TLS        1048576    0.0036298174858093264
md5        8          2.29191780090332e-06
md5        1024       4.240989685058594e-06
md5        1048576    0.002001429080963135
sha1       8          2.2377967834472654e-06
sha1       1024       3.712892532348633e-06
sha1       1048576    0.001439781904220581
sha256     8          2.4247169494628906e-06
sha256     1024       5.509614944458008e-06
sha256     1048576    0.003097315788269043
sha384     8          2.6009082794189455e-06
sha384     1024       4.739284515380859e-06
sha384     1048576    0.0020970926284790037
sha512     8          2.6662349700927734e-06
sha512     1024       4.82177734375e-06   
sha512     1048576    0.0020983285903930665
sha3_256   8          2.6617050170898437e-06
sha3_256   1024       6.140232086181641e-06
sha3_256   1048576    0.0037810275554656983
sha3_384   8          2.6824474334716796e-06
sha3_384   1024       7.116079330444336e-06
sha3_384   1048576    0.004900724887847901
sha3_512   8          2.6857852935791017e-06
sha3_512   1024       9.520530700683594e-06
sha3_512   1048576    0.007005348920822143

OPENSSL VERSION: OpenSSL 3.3.0-dev 
   ALGO     SIZE (B)        TIME (s)      
   ====     ========        ========      
TLS        0          0.00221125864982605 
TLS        1024       0.002240828275680542
TLS        1048576    0.003528764486312866
md5        8          2.2954940795898438e-06
md5        1024       4.289150238037109e-06
md5        1048576    0.0019974565505981447
sha1       8          2.3190975189208985e-06
sha1       1024       3.745555877685547e-06
sha1       1048576    0.0014349045753479005
sha256     8          2.4197101593017576e-06
sha256     1024       5.577325820922852e-06
sha256     1048576    0.00308963680267334 
sha384     8          2.5780200958251955e-06
sha384     1024       4.770755767822266e-06
sha384     1048576    0.0020952050685882568
sha512     8          2.63214111328125e-06
sha512     1024       4.817485809326172e-06
sha512     1048576    0.0020956623554229735
sha3_256   8          2.7365684509277343e-06
sha3_256   1024       6.3047409057617185e-06
sha3_256   1048576    0.0037728300094604494
sha3_384   8          2.7377605438232423e-06
sha3_384   1024       7.242679595947266e-06
sha3_384   1048576    0.004891997814178467
sha3_512   8          2.70390510559082e-06
sha3_512   1024       9.625434875488281e-06
sha3_512   1048576    0.006998764038085937

real    16m33.872s
user    36m54.465s
sys     5m28.766s
```
